import{s as P,o as $,n as W}from"../chunks/scheduler.wdSQypNi.js";import{S as q,i as ee,e as d,a as f,t as _,b as E,d as b,f as A,p as Q,g as k,m as te,s as R,h as Z,j as le,n as ie,c as V,k as X,x as B,y,q as H,r as K,u as se,v as Y,w as U,z,A as S}from"../chunks/index.xYm5eRWn.js";import{p as ce,M as ne,e as G}from"../chunks/main.gADFQzQ8.js";import{_ as M}from"../chunks/preload-helper.0HuHagjb.js";const oe="data:video/mp2t;base64,Ly9AdHMtY2hlY2sKLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KLy8vIDxyZWZlcmVuY2UgbGliPSJFUzIwMTUiIC8+Ci8vLyA8cmVmZXJlbmNlIGxpYj0id2Vid29ya2VyIiAvPgoKaW1wb3J0IHR5cGUge1cyT01lc3NhZ2UsIFcyT0xvbmdIYXVsUmVxdWVzdH0gZnJvbSAiLi93b3JrZXItdHlwZXMuanMiOwppbXBvcnQgdGhpbmdzIGZyb20gIi4vZ2xvYiI7CgpsZXQgY2FuY2VsbGVkVGlja2V0cyA9IG5ldyBTZXQoKTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGZ1bmN0aW9uKGV2ZW50OiBhbnkpIHsKICAgIGNvbnNvbGUubG9nKCJnb3QgbWVzc2FnZSIsIGV2ZW50LmRhdGEpOwogICAgbGV0IGRhdGEgPSBldmVudC5kYXRhIGFzIFcyT01lc3NhZ2UKICAgIHN3aXRjaChkYXRhLnR5cGUpIHsKICAgICAgICBjYXNlICJtaWRpIjoKICAgICAgICAgICAgcHJlcGFyZVdvcmsoZGF0YSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNhbmNlbCI6CiAgICAgICAgICAgIGNhbmNlbGxlZFRpY2tldHMuYWRkKGRhdGEudGlja2V0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrOwogICAgfQp9KQoKYXN5bmMgZnVuY3Rpb24gcHJlcGFyZVdvcmsoZGF0YTogVzJPTG9uZ0hhdWxSZXF1ZXN0ICYge3R5cGU6ICJtaWRpIn0pIHsKICAgIGxldCBzeW1ib2wgPSBTeW1ib2woKTsKICAgIGxldCBsYXN0UGluZyA9IDA7CiAgICBsZXQgcHJvZ3Jlc3NQb3N0ZXIgPSAoYWN0aW9uOiBzdHJpbmcsIHByb2dyZXNzOiBudW1iZXIpID0+IHsKICAgICAgICBpZihjYW5jZWxsZWRUaWNrZXRzLmhhcyhkYXRhLnRpY2tldCkpIHsKICAgICAgICAgICAgdGhyb3cgc3ltYm9sOwogICAgICAgIH0KICAgICAgICBsZXQgcGVyZiA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGlmKGxhc3RQaW5nID4gcGVyZiAtIDEpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsYXN0UGluZyA9IHBlcmY7CiAgICAgICAgcG9zdE1lc3NhZ2UoewogICAgICAgICAgICB0aWNrZXQ6IGRhdGEudGlja2V0LAogICAgICAgICAgICB0eXBlOiAicHJvZ3Jlc3MiLAogICAgICAgICAgICBwcm9ncmVzczogcHJvZ3Jlc3MsCiAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uCiAgICAgICAgfSkKICAgIH0KICAgIHRyeSB7CiAgICAgICAgcHJvZ3Jlc3NQb3N0ZXIoInNldHRpbmcgdXAiLCAwKTsKICAgICAgICBsZXQgdGhpbmcgPSBhd2FpdCB0aGluZ3NbZGF0YS5pZF0ud29ya2VyKCk7CiAgICAgICAgcHJvZ3Jlc3NQb3N0ZXIoInNldHRpbmcgdXAiLCAxKTsKICAgICAgICBsZXQgcmVzdWx0ID0gKHRoaW5nIGFzIGFueSkoZGF0YS5kYXRhLCBwcm9ncmVzc1Bvc3Rlcik7CiAgICAgICAgcG9zdE1lc3NhZ2UoewogICAgICAgICAgICB0aWNrZXQ6IGRhdGEudGlja2V0LAogICAgICAgICAgICBkYXRhOiByZXN1bHQsCiAgICAgICAgICAgIHR5cGU6ICJyZXN1bHQiCiAgICAgICAgfSkKICAgIH0KICAgIGNhdGNoKGUpIHsKICAgICAgICBpZihlID09IHN5bWJvbCkgewogICAgICAgICAgICBwb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0aWNrZXQ6IGRhdGEudGlja2V0LAogICAgICAgICAgICAgICAgdHlwZTogImNhbmNlbCIKICAgICAgICAgICAgfSkKICAgICAgICAgICAgY2FuY2VsbGVkVGlja2V0cy5kZWxldGUoZGF0YS50aWNrZXQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRocm93IGU7CiAgICB9Cn0KCmV4cG9ydCBkZWZhdWx0IDEwOw==";let p=Object.create(null);function x(c,e,s){e!==void 0&&(p[e]===void 0&&(p[e]={}),p[e][c]=s)}let ge=Object.assign({"./visualisers/bouncyball/worker.ts":()=>M(()=>import("../chunks/worker.ZMdZcWa-.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(c=>c.default)}),w=new RegExp("\\./visualisers/(.+?)/worker\\.ts");Object.entries(ge).forEach(c=>{x("worker",w.exec(c[0])?.[1],c[1])});let re=Object.assign({"./visualisers/bouncyball/visualiser.svelte":()=>M(()=>import("../chunks/visualiser.DMu-2j8Y.js"),__vite__mapDeps([3,4,5,1,2]),import.meta.url).then(c=>c.default)});w=new RegExp("\\./visualisers/(.+?)/visualiser\\.svelte");Object.entries(re).forEach(c=>{x("visualiser",w.exec(c[0])?.[1],c[1])});class Ie{worker;nextTicket=0;tickets=new Map;constructor(e){this.worker=e,e.addEventListener("message",s=>{let t=s.data;if(console.log("got message",t),t.type=="progress"){let i=this.tickets.get(t.ticket);i?.progress(t.progress,t.action)}else if(t.type=="result"){let i=this.tickets.get(t.ticket);i!=null&&(i.result(t.data),this.tickets.delete(t.ticket))}else if(t.type=="cancel"){let i=this.tickets.get(t.ticket);i!=null&&(i.cancel(),this.tickets.delete(t.ticket))}})}longHaul(e,s){let t=this.nextTicket++,i={...e,ticket:t};return this.tickets.set(t,s),this.worker.postMessage(i),()=>{this.worker.postMessage({type:"cancel",ticket:t})}}terminate(){this.worker.terminate(),this.tickets.forEach(e=>e.cancel()),this.tickets.clear()}}async function ae(){return new Ie(new Worker(oe,{name:"visualiser worker",type:"module"}))}function J(c,e,s){const t=c.slice();t[11]=e[s];const i=t[2];return t[12]=i,t}function F(c,e,s){const t=c.slice();return t[15]=e[s],t}function Ce(c){let e,s,t,i,n,l,g,o,r=c[0]!=null&&L(c),a=c[2]!=null&&T(c);return{c(){e=k("label"),s=te("Input midi file "),t=k("input"),i=R(),r&&r.c(),n=R(),a&&a.c(),l=d(),this.h()},l(I){e=Z(I,"LABEL",{});var C=le(e);s=ie(C,"Input midi file "),t=Z(C,"INPUT",{type:!0,accept:!0}),C.forEach(A),i=V(I),r&&r.l(I),n=V(I),a&&a.l(I),l=d(),this.h()},h(){X(t,"type","file"),X(t,"accept","audio/midi")},m(I,C){f(I,e,C),B(e,s),B(e,t),f(I,i,C),r&&r.m(I,C),f(I,n,C),a&&a.m(I,C),f(I,l,C),g||(o=y(t,"change",c[7]),g=!0)},p(I,C){I[0]!=null?r?r.p(I,C):(r=L(I),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null),I[2]!=null?a?a.p(I,C):(a=T(I),a.c(),a.m(l.parentNode,l)):a&&(a.d(1),a=null)},i:W,o:W,d(I){I&&(A(e),A(i),A(n),A(l)),r&&r.d(I),a&&a.d(I),g=!1,o()}}}function ue(c){let e,s,t;var i=c[3];function n(l,g){return{props:{data:l[4],midi:l[1]}}}return i&&(e=H(i,n(c))),{c(){e&&K(e.$$.fragment),s=d()},l(l){e&&se(e.$$.fragment,l),s=d()},m(l,g){e&&Y(e,l,g),f(l,s,g),t=!0},p(l,g){if(g&8&&i!==(i=l[3])){if(e){Q();const o=e;_(o.$$.fragment,1,0,()=>{U(o,1)}),E()}i?(e=H(i,n(l)),K(e.$$.fragment),b(e.$$.fragment,1),Y(e,s.parentNode,s)):e=null}else if(i){const o={};g&16&&(o.data=l[4]),g&2&&(o.midi=l[1]),e.$set(o)}},i(l){t||(e&&b(e.$$.fragment,l),t=!0)},o(l){e&&_(e.$$.fragment,l),t=!1},d(l){l&&A(s),e&&U(e,l)}}}function L(c){let e,s=G(c[0]),t=[];for(let i=0;i<s.length;i+=1)t[i]=O(F(c,s,i));return{c(){for(let i=0;i<t.length;i+=1)t[i].c();e=d()},l(i){for(let n=0;n<t.length;n+=1)t[n].l(i);e=d()},m(i,n){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(i,n);f(i,e,n)},p(i,n){if(n&5){s=G(i[0]);let l;for(l=0;l<s.length;l+=1){const g=F(i,s,l);t[l]?t[l].p(g,n):(t[l]=O(g),t[l].c(),t[l].m(e.parentNode,e))}for(;l<t.length;l+=1)t[l].d(1);t.length=s.length}},d(i){i&&A(e),z(t,i)}}}function O(c){let e,s="select music",t,i;function n(){return c[8](c[15])}return{c(){e=k("button"),e.textContent=s},l(l){e=Z(l,"BUTTON",{"data-svelte-h":!0}),S(e)!=="svelte-u5h6qh"&&(e.textContent=s)},m(l,g){f(l,e,g),t||(i=y(e,"click",n),t=!0)},p(l,g){c=l},d(l){l&&A(e),t=!1,i()}}}function T(c){let e,s=G(Object.keys(p)),t=[];for(let i=0;i<s.length;i+=1)t[i]=j(J(c,s,i));return{c(){for(let i=0;i<t.length;i+=1)t[i].c();e=d()},l(i){for(let n=0;n<t.length;n+=1)t[n].l(i);e=d()},m(i,n){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(i,n);f(i,e,n)},p(i,n){if(n&76){s=G(Object.keys(p));let l;for(l=0;l<s.length;l+=1){const g=J(i,s,l);t[l]?t[l].p(g,n):(t[l]=j(g),t[l].c(),t[l].m(e.parentNode,e))}for(;l<t.length;l+=1)t[l].d(1);t.length=s.length}},d(i){i&&A(e),z(t,i)}}}function j(c){let e,s="select visualiser",t,i;function n(){return c[9](c[12],c[11])}return{c(){e=k("button"),e.textContent=s},l(l){e=Z(l,"BUTTON",{"data-svelte-h":!0}),S(e)!=="svelte-j1e5w2"&&(e.textContent=s)},m(l,g){f(l,e,g),t||(i=y(e,"click",n),t=!0)},p(l,g){c=l},d(l){l&&A(e),t=!1,i()}}}function Ae(c){let e,s,t,i;const n=[ue,Ce],l=[];function g(o,r){return o[4]!=null&&o[3]!=null?0:1}return e=g(c),s=l[e]=n[e](c),{c(){s.c(),t=d()},l(o){s.l(o),t=d()},m(o,r){l[e].m(o,r),f(o,t,r),i=!0},p(o,[r]){let a=e;e=g(o),e===a?l[e].p(o,r):(Q(),_(l[a],1,1,()=>{l[a]=null}),E(),s=l[e],s?s.p(o,r):(s=l[e]=n[e](o),s.c()),b(s,1),s.m(t.parentNode,t))},i(o){i||(b(s),i=!0)},o(o){_(s),i=!1},d(o){o&&A(t),l[e].d(o)}}}function fe(c,e,s){let t=null,i=null,n=null,l=null,g=null,o=null;function r(u){let m=u.files;if(m==null||m.length==0)return;let h=m[0];h.arrayBuffer().then(N=>{let D=ce.parse(new Uint8Array(N)),v=new ne(D).getAvailableMusics();v.length==1?s(2,n=v[0]):s(0,t=v),s(1,i=URL.createObjectURL(h))})}function a(u,m){console.log("owrking"),console.log(u.structure()),l.longHaul({type:"midi",id:m,data:u.structure()},{progress:(h,N)=>{console.log("progress:",h,N)},result:h=>{console.log("data:",h),s(4,o=h)},cancel:()=>{console.log("cancelled")}})}return $(()=>{ae().then(u=>l=u)}),[t,i,n,g,o,r,a,u=>r(u.currentTarget),u=>{s(2,n=u),s(0,t=null)},(u,m)=>{a(u,m),p[m].visualiser().then(h=>s(3,g=h)),s(2,n=null)}]}class be extends q{constructor(e){super(),ee(this,e,fe,Ae,P,{})}}export{be as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["../chunks/worker.ZMdZcWa-.js","../chunks/main.gADFQzQ8.js","../chunks/physics.j8OraWG_.js","../chunks/visualiser.DMu-2j8Y.js","../chunks/scheduler.wdSQypNi.js","../chunks/index.xYm5eRWn.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{s as J,o as K,n as E}from"../chunks/scheduler.wdSQypNi.js";import{S as Q,i as Y,e as d,a as m,t as v,b as S,d as w,f as h,p as z,g as y,m as Z,s as U,h as j,j as x,n as ee,c as C,k as M,x as R,y as T,q as W,r as A,u as te,v as $,w as B,z as F,A as X}from"../chunks/index.xYm5eRWn.js";import{p as le,M as ne,e as L}from"../chunks/main.gADFQzQ8.js";import{_ as ie}from"../chunks/preload-helper.0HuHagjb.js";function se(s){return new Worker(""+new URL("../workers/work-8AWpXLdj.js",import.meta.url).href,{type:"module",name:s?.name})}let b=Object.create(null);function re(s,e,i){e!==void 0&&(b[e]===void 0&&(b[e]={}),b[e][s]=i)}let oe=Object.assign({"./visualisers/bouncyball/visualiser.svelte":()=>ie(()=>import("../chunks/visualiser.3zAnm6lg.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(s=>s.default)}),ce=new RegExp("\\./visualisers/(.+?)/visualiser\\.svelte");Object.entries(oe).forEach(s=>{re("visualiser",ce.exec(s[0])?.[1],s[1])});class ae{worker;nextTicket=0;tickets=new Map;constructor(e){this.worker=e,e.addEventListener("message",i=>{let t=i.data;if(console.log("got message",t),t.type=="progress"){let n=this.tickets.get(t.ticket);n?.progress(t.progress,t.action)}else if(t.type=="result"){let n=this.tickets.get(t.ticket);n!=null&&(n.result(t.data),this.tickets.delete(t.ticket))}else if(t.type=="cancel"){let n=this.tickets.get(t.ticket);n!=null&&(n.cancel(),this.tickets.delete(t.ticket))}})}longHaul(e,i){let t=this.nextTicket++,n={...e,ticket:t};return this.tickets.set(t,i),this.worker.postMessage(n),()=>{this.worker.postMessage({type:"cancel",ticket:t})}}terminate(){this.worker.terminate(),this.tickets.forEach(e=>e.cancel()),this.tickets.clear()}}async function ue(){return new ae(new se)}function I(s,e,i){const t=s.slice();t[11]=e[i];const n=t[2];return t[12]=n,t}function P(s,e,i){const t=s.slice();return t[15]=e[i],t}function fe(s){let e,i,t,n,r,l,c,o,a=s[0]!=null&&q(s),f=s[2]!=null&&D(s);return{c(){e=y("label"),i=Z("Input midi file "),t=y("input"),n=U(),a&&a.c(),r=U(),f&&f.c(),l=d(),this.h()},l(u){e=j(u,"LABEL",{});var _=x(e);i=ee(_,"Input midi file "),t=j(_,"INPUT",{type:!0,accept:!0}),_.forEach(h),n=C(u),a&&a.l(u),r=C(u),f&&f.l(u),l=d(),this.h()},h(){M(t,"type","file"),M(t,"accept","audio/midi")},m(u,_){m(u,e,_),R(e,i),R(e,t),m(u,n,_),a&&a.m(u,_),m(u,r,_),f&&f.m(u,_),m(u,l,_),c||(o=T(t,"change",s[7]),c=!0)},p(u,_){u[0]!=null?a?a.p(u,_):(a=q(u),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null),u[2]!=null?f?f.p(u,_):(f=D(u),f.c(),f.m(l.parentNode,l)):f&&(f.d(1),f=null)},i:E,o:E,d(u){u&&(h(e),h(n),h(r),h(l)),a&&a.d(u),f&&f.d(u),c=!1,o()}}}function _e(s){let e,i,t;var n=s[3];function r(l,c){return{props:{data:l[4],midi:l[1]}}}return n&&(e=W(n,r(s))),{c(){e&&A(e.$$.fragment),i=d()},l(l){e&&te(e.$$.fragment,l),i=d()},m(l,c){e&&$(e,l,c),m(l,i,c),t=!0},p(l,c){if(c&8&&n!==(n=l[3])){if(e){z();const o=e;v(o.$$.fragment,1,0,()=>{B(o,1)}),S()}n?(e=W(n,r(l)),A(e.$$.fragment),w(e.$$.fragment,1),$(e,i.parentNode,i)):e=null}else if(n){const o={};c&16&&(o.data=l[4]),c&2&&(o.midi=l[1]),e.$set(o)}},i(l){t||(e&&w(e.$$.fragment,l),t=!0)},o(l){e&&v(e.$$.fragment,l),t=!1},d(l){l&&h(i),e&&B(e,l)}}}function q(s){let e,i=L(s[0]),t=[];for(let n=0;n<i.length;n+=1)t[n]=V(P(s,i,n));return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=d()},l(n){for(let r=0;r<t.length;r+=1)t[r].l(n);e=d()},m(n,r){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(n,r);m(n,e,r)},p(n,r){if(r&5){i=L(n[0]);let l;for(l=0;l<i.length;l+=1){const c=P(n,i,l);t[l]?t[l].p(c,r):(t[l]=V(c),t[l].c(),t[l].m(e.parentNode,e))}for(;l<t.length;l+=1)t[l].d(1);t.length=i.length}},d(n){n&&h(e),F(t,n)}}}function V(s){let e,i="select music",t,n;function r(){return s[8](s[15])}return{c(){e=y("button"),e.textContent=i},l(l){e=j(l,"BUTTON",{"data-svelte-h":!0}),X(e)!=="svelte-u5h6qh"&&(e.textContent=i)},m(l,c){m(l,e,c),t||(n=T(e,"click",r),t=!0)},p(l,c){s=l},d(l){l&&h(e),t=!1,n()}}}function D(s){let e,i=L(Object.keys(b)),t=[];for(let n=0;n<i.length;n+=1)t[n]=H(I(s,i,n));return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=d()},l(n){for(let r=0;r<t.length;r+=1)t[r].l(n);e=d()},m(n,r){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(n,r);m(n,e,r)},p(n,r){if(r&76){i=L(Object.keys(b));let l;for(l=0;l<i.length;l+=1){const c=I(n,i,l);t[l]?t[l].p(c,r):(t[l]=H(c),t[l].c(),t[l].m(e.parentNode,e))}for(;l<t.length;l+=1)t[l].d(1);t.length=i.length}},d(n){n&&h(e),F(t,n)}}}function H(s){let e,i="select visualiser",t,n;function r(){return s[9](s[12],s[11])}return{c(){e=y("button"),e.textContent=i},l(l){e=j(l,"BUTTON",{"data-svelte-h":!0}),X(e)!=="svelte-j1e5w2"&&(e.textContent=i)},m(l,c){m(l,e,c),t||(n=T(e,"click",r),t=!0)},p(l,c){s=l},d(l){l&&h(e),t=!1,n()}}}function pe(s){let e,i,t,n;const r=[_e,fe],l=[];function c(o,a){return o[4]!=null&&o[3]!=null?0:1}return e=c(s),i=l[e]=r[e](s),{c(){i.c(),t=d()},l(o){i.l(o),t=d()},m(o,a){l[e].m(o,a),m(o,t,a),n=!0},p(o,[a]){let f=e;e=c(o),e===f?l[e].p(o,a):(z(),v(l[f],1,1,()=>{l[f]=null}),S(),i=l[e],i?i.p(o,a):(i=l[e]=r[e](o),i.c()),w(i,1),i.m(t.parentNode,t))},i(o){n||(w(i),n=!0)},o(o){v(i),n=!1},d(o){o&&h(t),l[e].d(o)}}}function he(s,e,i){let t=null,n=null,r=null,l=null,c=null,o=null;function a(p){let g=p.files;if(g==null||g.length==0)return;let k=g[0];k.arrayBuffer().then(N=>{let G=le.parse(new Uint8Array(N)),O=new ne(G).getAvailableMusics();O.length==1?i(2,r=O[0]):i(0,t=O),i(1,n=URL.createObjectURL(k))})}function f(p,g){console.log("owrking"),console.log(p.structure()),l.longHaul({type:"midi",id:g,data:p.structure()},{progress:(k,N)=>{console.log("progress:",k,N)},result:k=>{console.log("data:",k),i(4,o=k)},cancel:()=>{console.log("cancelled")}})}return K(()=>{ue().then(p=>l=p)}),[t,n,r,c,o,a,f,p=>a(p.currentTarget),p=>{i(2,r=p),i(0,t=null)},(p,g)=>{f(p,g),b[g].visualiser().then(k=>i(3,c=k)),i(2,r=null)}]}class ve extends Q{constructor(e){super(),Y(this,e,he,pe,J,{})}}export{ve as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["../chunks/visualiser.3zAnm6lg.js","../chunks/scheduler.wdSQypNi.js","../chunks/index.xYm5eRWn.js","../chunks/main.gADFQzQ8.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
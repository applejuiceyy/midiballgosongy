import{s as be,n as Z,r as we}from"../chunks/scheduler.wdSQypNi.js";import{S as Ne,i as Be,g as J,m as V,s as K,B as W,e as E,h as U,j as L,n as q,f as g,c as R,C as X,k as v,a as y,x as C,y as Q,o as G,z as j,A as ye,l as M}from"../chunks/index.xYm5eRWn.js";import{e as D,p as Te,M as Ie}from"../chunks/main.gADFQzQ8.js";function $(r,t,n){const e=r.slice();return e[19]=t[n],e}function x(r,t,n){const e=r.slice();return e[19]=t[n],e}function ee(r,t,n){const e=r.slice();return e[24]=t[n],e[26]=n,e}function te(r,t,n){const e=r.slice();return e[27]=t[n],e}function le(r,t,n){const e=r.slice();return e[30]=t[n],e}function ne(r,t,n){const e=r.slice();return e[19]=t[n],e}function ie(r,t,n){const e=r.slice();return e[35]=t[n],e[37]=n,e}function fe(r,t,n){const e=r.slice();e[38]=t[n],e[26]=n;const l=e[35].event[e[26]+e[1].trackInfo[e[37]].currentPosition];return e[19]=l,e}function re(r,t,n){const e=r.slice();return e[40]=t[n],e}function oe(r){let t,n=D(r[0]),e=[];for(let l=0;l<n.length;l+=1)e[l]=ce(re(r,n,l));return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=E()},l(l){for(let f=0;f<e.length;f+=1)e[f].l(l);t=E()},m(l,f){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(l,f);y(l,t,f)},p(l,f){if(f[0]&1025){n=D(l[0]);let i;for(i=0;i<n.length;i+=1){const a=re(l,n,i);e[i]?e[i].p(a,f):(e[i]=ce(a),e[i].c(),e[i].m(t.parentNode,t))}for(;i<e.length;i+=1)e[i].d(1);e.length=n.length}},d(l){l&&g(t),j(e,l)}}}function ce(r){let t,n,e="Play",l,f;function i(){return r[14](r[40])}return{c(){t=V(`this is a play
        `),n=J("button"),n.textContent=e},l(a){t=q(a,`this is a play
        `),n=U(a,"BUTTON",{"data-svelte-h":!0}),ye(n)!=="svelte-1vyaauj"&&(n.textContent=e)},m(a,u){y(a,t,u),y(a,n,u),l||(f=Q(n,"click",i),l=!0)},p(a,u){r=a},d(a){a&&(g(t),g(n)),l=!1,f()}}}function he(r){let t,n="Play",e,l,f,i,a,u=D(r[1].owner.tracks),d=[];for(let h=0;h<u.length;h+=1)d[h]=_e(ie(r,u,h));let w=D(r[6]),b=[];for(let h=0;h<w.length;h+=1)b[h]=ue(ne(r,w,h));return{c(){t=J("button"),t.textContent=n,e=K();for(let h=0;h<d.length;h+=1)d[h].c();l=K();for(let h=0;h<b.length;h+=1)b[h].c();f=E()},l(h){t=U(h,"BUTTON",{"data-svelte-h":!0}),ye(t)!=="svelte-18bh5x3"&&(t.textContent=n),e=R(h);for(let k=0;k<d.length;k+=1)d[k].l(h);l=R(h);for(let k=0;k<b.length;k+=1)b[k].l(h);f=E()},m(h,k){y(h,t,k),y(h,e,k);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,k);y(h,l,k);for(let _=0;_<b.length;_+=1)b[_]&&b[_].m(h,k);y(h,f,k),i||(a=Q(t,"click",r[15]),i=!0)},p(h,k){if(k[0]&18){u=D(h[1].owner.tracks);let _;for(_=0;_<u.length;_+=1){const S=ie(h,u,_);d[_]?d[_].p(S,k):(d[_]=_e(S),d[_].c(),d[_].m(l.parentNode,l))}for(;_<d.length;_+=1)d[_].d(1);d.length=u.length}if(k[0]&64){w=D(h[6]);let _;for(_=0;_<w.length;_+=1){const S=ne(h,w,_);b[_]?b[_].p(S,k):(b[_]=ue(S),b[_].c(),b[_].m(f.parentNode,f))}for(;_<b.length;_+=1)b[_].d(1);b.length=w.length}},d(h){h&&(g(t),g(e),g(l),g(f)),j(d,h),j(b,h),i=!1,a()}}}function ae(r){let t,n=r[19].deltaTime+"",e,l,f=JSON.stringify(r[19])+"",i;return{c(){t=J("div"),e=V(n),l=J("br"),i=V(f),this.h()},l(a){t=U(a,"DIV",{style:!0});var u=L(t);e=q(u,n),l=U(u,"BR",{}),i=q(u,f),u.forEach(g),this.h()},h(){M(t,"display","inline-block"),M(t,"width","80px"),M(t,"height","40px"),M(t,"background-color",r[19].type==9?"#3333ff":"#33ff33"),M(t,"margin","3px")},m(a,u){y(a,t,u),C(t,e),C(t,l),C(t,i)},p(a,u){u[0]&2&&n!==(n=a[19].deltaTime+"")&&G(e,n),u[0]&2&&f!==(f=JSON.stringify(a[19])+"")&&G(i,f),u[0]&2&&M(t,"background-color",a[19].type==9?"#3333ff":"#33ff33")},d(a){a&&g(t)}}}function se(r){let t,n=D({length:Math.min(10,r[35].event.length-r[1].trackInfo[r[37]].currentPosition)}),e=[];for(let l=0;l<n.length;l+=1)e[l]=ae(fe(r,n,l));return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=E()},l(l){for(let f=0;f<e.length;f+=1)e[f].l(l);t=E()},m(l,f){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(l,f);y(l,t,f)},p(l,f){if(f[0]&2){n=D({length:Math.min(10,l[35].event.length-l[1].trackInfo[l[37]].currentPosition)});let i;for(i=0;i<n.length;i+=1){const a=fe(l,n,i);e[i]?e[i].p(a,f):(e[i]=ae(a),e[i].c(),e[i].m(t.parentNode,t))}for(;i<e.length;i+=1)e[i].d(1);e.length=n.length}},d(l){l&&g(t),j(e,l)}}}function _e(r){let t,n=r[4],e=se(r);return{c(){t=J("div"),e.c(),this.h()},l(l){t=U(l,"DIV",{style:!0});var f=L(t);e.l(f),f.forEach(g),this.h()},h(){M(t,"background-color","#4444ff"),M(t,"margin","5px")},m(l,f){y(l,t,f),e.m(t,null)},p(l,f){f[0]&16&&be(n,n=l[4])?(e.d(1),e=se(l),e.c(),e.m(t,null)):e.p(l,f)},d(l){l&&g(t),e.d(l)}}}function ue(r){let t,n=r[19].event.deltaTime+"",e,l,f=JSON.stringify(r[19])+"",i,a;return{c(){t=J("div"),e=V(n),l=J("br"),i=V(f),a=K(),this.h()},l(u){t=U(u,"DIV",{style:!0});var d=L(t);e=q(d,n),l=U(d,"BR",{}),i=q(d,f),a=R(d),d.forEach(g),this.h()},h(){M(t,"display","inline-block"),M(t,"width","80px"),M(t,"height","40px"),M(t,"background-color",r[19].event.type==9?"#3333ff":"#33ff33"),M(t,"margin","3px")},m(u,d){y(u,t,d),C(t,e),C(t,l),C(t,i),C(t,a)},p(u,d){d[0]&64&&n!==(n=u[19].event.deltaTime+"")&&G(e,n),d[0]&64&&f!==(f=JSON.stringify(u[19])+"")&&G(i,f),d[0]&64&&M(t,"background-color",u[19].event.type==9?"#3333ff":"#33ff33")},d(u){u&&g(t)}}}function pe(r){let t,n,e,l,f;return{c(){t=W("rect"),this.h()},l(i){t=X(i,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0}),L(t).forEach(g),this.h()},h(){v(t,"x",n=r[30].start/30),v(t,"y",e=r[30].verticality*5),v(t,"width",l=(r[30].end-r[30].start)/30),v(t,"height",5),v(t,"fill",f="hsl("+r[30].channel*20+",100%,50%)"),v(t,"stroke","#000000")},m(i,a){y(i,t,a)},p(i,a){a[0]&256&&n!==(n=i[30].start/30)&&v(t,"x",n),a[0]&256&&e!==(e=i[30].verticality*5)&&v(t,"y",e),a[0]&256&&l!==(l=(i[30].end-i[30].start)/30)&&v(t,"width",l),a[0]&256&&f!==(f="hsl("+i[30].channel*20+",100%,50%)")&&v(t,"fill",f)},d(i){i&&g(t)}}}function de(r){let t,n,e,l;return{c(){t=W("rect"),this.h()},l(f){t=X(f,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0}),L(t).forEach(g),this.h()},h(){v(t,"x",n=r[27][1]/30),v(t,"y",e=Number(r[27][0])*5),v(t,"width",l=(r[3]-r[27][1])/30),v(t,"height",5),v(t,"fill","hsl("+r[26]*20+",100%,50%)"),v(t,"stroke","#000000")},m(f,i){y(f,t,i)},p(f,i){i[0]&128&&n!==(n=f[27][1]/30)&&v(t,"x",n),i[0]&128&&e!==(e=Number(f[27][0])*5)&&v(t,"y",e),i[0]&136&&l!==(l=(f[3]-f[27][1])/30)&&v(t,"width",l)},d(f){f&&g(t)}}}function ge(r){let t,n=D(Object.entries(r[24])),e=[];for(let l=0;l<n.length;l+=1)e[l]=de(te(r,n,l));return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=E()},l(l){for(let f=0;f<e.length;f+=1)e[f].l(l);t=E()},m(l,f){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(l,f);y(l,t,f)},p(l,f){if(f[0]&136){n=D(Object.entries(l[24]));let i;for(i=0;i<n.length;i+=1){const a=te(l,n,i);e[i]?e[i].p(a,f):(e[i]=de(a),e[i].c(),e[i].m(t.parentNode,t))}for(;i<e.length;i+=1)e[i].d(1);e.length=n.length}},d(l){l&&g(t),j(e,l)}}}function me(r){let t,n;return{c(){t=W("rect"),this.h()},l(e){t=X(e,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),L(t).forEach(g),this.h()},h(){v(t,"x","0"),v(t,"y",n=r[19].event.data[0]*5),v(t,"width","100%"),v(t,"height",5),v(t,"fill","#00000044")},m(e,l){y(e,t,l)},p(e,l){l[0]&64&&n!==(n=e[19].event.data[0]*5)&&v(t,"y",n)},d(e){e&&g(t)}}}function ve(r){let t,n=(r[19].event.type==8||r[19].event.type==9)&&me(r);return{c(){n&&n.c(),t=E()},l(e){n&&n.l(e),t=E()},m(e,l){n&&n.m(e,l),y(e,t,l)},p(e,l){e[19].event.type==8||e[19].event.type==9?n?n.p(e,l):(n=me(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&g(t),n&&n.d(e)}}}function ke(r){let t=r[19]+"",n,e;return{c(){n=V(t),e=J("br")},l(l){n=q(l,t),e=U(l,"BR",{})},m(l,f){y(l,n,f),y(l,e,f)},p(l,f){f[0]&32&&t!==(t=l[19]+"")&&G(n,t)},d(l){l&&(g(n),g(e))}}}function Pe(r){let t,n,e,l,f,i,a=r[2]-r[3]+"",u,d,w,b,h,k,_,S,H,T=r[0]!=null&&oe(r),I=r[1]!=null&&he(r),z=D(r[8]),P=[];for(let o=0;o<z.length;o+=1)P[o]=pe(le(r,z,o));let F=D(r[7]),p=[];for(let o=0;o<F.length;o+=1)p[o]=ge(ee(r,F,o));let O=D(r[6]),N=[];for(let o=0;o<O.length;o+=1)N[o]=ve(x(r,O,o));let A=D(r[5]),B=[];for(let o=0;o<A.length;o+=1)B[o]=ke($(r,A,o));return{c(){t=J("label"),n=V("Input midi file "),e=J("input"),l=K(),T&&T.c(),f=K(),I&&I.c(),i=K(),u=V(a),d=K(),w=W("svg");for(let o=0;o<P.length;o+=1)P[o].c();b=E();for(let o=0;o<p.length;o+=1)p[o].c();h=E();for(let o=0;o<N.length;o+=1)N[o].c();k=K();for(let o=0;o<B.length;o+=1)B[o].c();_=E(),this.h()},l(o){t=U(o,"LABEL",{});var m=L(t);n=q(m,"Input midi file "),e=U(m,"INPUT",{type:!0,accept:!0}),m.forEach(g),l=R(o),T&&T.l(o),f=R(o),I&&I.l(o),i=R(o),u=q(o,a),d=R(o),w=X(o,"svg",{width:!0,height:!0});var c=L(w);for(let s=0;s<P.length;s+=1)P[s].l(c);b=E();for(let s=0;s<p.length;s+=1)p[s].l(c);h=E();for(let s=0;s<N.length;s+=1)N[s].l(c);c.forEach(g),k=R(o);for(let s=0;s<B.length;s+=1)B[s].l(o);_=E(),this.h()},h(){v(e,"type","file"),v(e,"accept","audio/midi"),v(w,"width","10000"),v(w,"height","1000")},m(o,m){y(o,t,m),C(t,n),C(t,e),y(o,l,m),T&&T.m(o,m),y(o,f,m),I&&I.m(o,m),y(o,i,m),y(o,u,m),y(o,d,m),y(o,w,m);for(let c=0;c<P.length;c+=1)P[c]&&P[c].m(w,null);C(w,b);for(let c=0;c<p.length;c+=1)p[c]&&p[c].m(w,null);C(w,h);for(let c=0;c<N.length;c+=1)N[c]&&N[c].m(w,null);y(o,k,m);for(let c=0;c<B.length;c+=1)B[c]&&B[c].m(o,m);y(o,_,m),S||(H=[Q(window,"keydown",r[11]),Q(window,"keyup",r[12]),Q(e,"change",r[13])],S=!0)},p(o,m){if(o[0]!=null?T?T.p(o,m):(T=oe(o),T.c(),T.m(f.parentNode,f)):T&&(T.d(1),T=null),o[1]!=null?I?I.p(o,m):(I=he(o),I.c(),I.m(i.parentNode,i)):I&&(I.d(1),I=null),m[0]&12&&a!==(a=o[2]-o[3]+"")&&G(u,a),m[0]&256){z=D(o[8]);let c;for(c=0;c<z.length;c+=1){const s=le(o,z,c);P[c]?P[c].p(s,m):(P[c]=pe(s),P[c].c(),P[c].m(w,b))}for(;c<P.length;c+=1)P[c].d(1);P.length=z.length}if(m[0]&136){F=D(o[7]);let c;for(c=0;c<F.length;c+=1){const s=ee(o,F,c);p[c]?p[c].p(s,m):(p[c]=ge(s),p[c].c(),p[c].m(w,h))}for(;c<p.length;c+=1)p[c].d(1);p.length=F.length}if(m[0]&64){O=D(o[6]);let c;for(c=0;c<O.length;c+=1){const s=x(o,O,c);N[c]?N[c].p(s,m):(N[c]=ve(s),N[c].c(),N[c].m(w,null))}for(;c<N.length;c+=1)N[c].d(1);N.length=O.length}if(m[0]&32){A=D(o[5]);let c;for(c=0;c<A.length;c+=1){const s=$(o,A,c);B[c]?B[c].p(s,m):(B[c]=ke(s),B[c].c(),B[c].m(_.parentNode,_))}for(;c<B.length;c+=1)B[c].d(1);B.length=A.length}},i:Z,o:Z,d(o){o&&(g(t),g(l),g(f),g(i),g(u),g(d),g(w),g(k),g(_)),T&&T.d(o),I&&I.d(o),j(P,o),j(p,o),j(N,o),j(B,o),S=!1,we(H)}}}function De(r,t,n){let e=null,l=null,f=0,i=0,a=0,u=!0,d=0,w=[],b=[],h=[];for(let p=0;p<15;p++)h.push({});let k=[];function _(p){let O=p.files;if(O==null||O.length==0)return;O[0].arrayBuffer().then(A=>{let B=Te.parse(new Uint8Array(A));n(0,e=new Ie(B).getAvailableMusics())})}function S(){if(l==null)return;let p=performance.now()*1e3,O=p-d,N=l.owner.owner.data.timeDivision,A=l.microsecondsPerBeat,o=O/A*N;for(u&&n(3,i+=o);i>=f;){for(let c=0;c<b.length;c++){let s=b[c].event;s.type==9&&s.data[1]===0&&(s={...s,type:8});let Y=!1;(s.type==8||s.type==9)&&h[s.channel][s.data[0]]!=null&&(h[s.channel][s.data[0]],k.push({start:h[s.channel][s.data[0]],end:f,verticality:s.data[0],channel:s.channel}),n(8,k),delete h[s.channel][s.data[0]],n(7,h),Y=!0,n(5,w)),s.type==9&&(Y=!0,n(7,h[s.channel][s.data[0]]=f,h)),Y&&w.push(JSON.stringify(s))}let m=l.next();if(m.done){n(1,l=null);return}n(6,b=m.value.events),n(2,f+=m.value.after),n(4,a+=1)}d=p}function H(p){n(1,l=p.play()),console.log(l),n(3,i=0),d=performance.now()*1e3,setInterval(S,1)}function T(p){p.code=="Space"&&(p.preventDefault(),u=!0),p.code=="KeyE"&&(p.preventDefault(),n(3,i++,i))}function I(p){p.code=="Space"&&(p.preventDefault(),u=!1)}return[e,l,f,i,a,w,b,h,k,_,H,T,I,p=>_(p.currentTarget),p=>H(p),()=>console.log(l?.next())]}class Se extends Ne{constructor(t){super(),Be(this,t,De,Pe,be,{},null,[-1,-1])}}export{Se as component};
